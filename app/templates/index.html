<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proyección de Inventario</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='dist/css/output.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
    <script src="{{ url_for('static', filename='js/app.js') }}" defer></script>
</head>
<body class="bg-gray-50">
    <!-- Navbar -->
    <nav class="bg-indigo-600 text-white shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <i class="fas fa-chart-line text-xl mr-2"></i>
                    <span class="font-bold text-xl">Sistema de Pronóstico</span>
                </div>
                <button class="md:hidden flex items-center" type="button" id="mobile-menu-button">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="hidden md:flex items-center space-x-4">
                    <a href="#" class="text-white hover:bg-indigo-700 px-3 py-2 rounded-md text-sm font-medium flex items-center">
                        <i class="fas fa-home mr-1"></i> Inicio
                    </a>
                    <a href="#forecast-section" class="text-white hover:bg-indigo-700 px-3 py-2 rounded-md text-sm font-medium flex items-center">
                        <i class="fas fa-chart-pie mr-1"></i> Pronósticos
                    </a>
                    <a href="#data-section" class="text-white hover:bg-indigo-700 px-3 py-2 rounded-md text-sm font-medium flex items-center">
                        <i class="fas fa-database mr-1"></i> Datos
                    </a>
                    <a href="#help-section" class="text-white hover:bg-indigo-700 px-3 py-2 rounded-md text-sm font-medium flex items-center">
                        <i class="fas fa-question-circle mr-1"></i> Ayuda
                    </a>
                </div>
            </div>
            <!-- Mobile menu, show/hide based on menu state -->
            <div class="md:hidden hidden" id="mobile-menu">
                <div class="px-2 pt-2 pb-3 space-y-1">
                    <a href="#" class="text-white block px-3 py-2 rounded-md text-base font-medium hover:bg-indigo-700">
                        <i class="fas fa-home mr-1"></i> Inicio
                    </a>
                    <a href="#forecast-section" class="text-white block px-3 py-2 rounded-md text-base font-medium hover:bg-indigo-700">
                        <i class="fas fa-chart-pie mr-1"></i> Pronósticos
                    </a>
                    <a href="#data-section" class="text-white block px-3 py-2 rounded-md text-base font-medium hover:bg-indigo-700">
                        <i class="fas fa-database mr-1"></i> Datos
                    </a>
                    <a href="#help-section" class="text-white block px-3 py-2 rounded-md text-base font-medium hover:bg-indigo-700">
                        <i class="fas fa-question-circle mr-1"></i> Ayuda
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Dashboard Section -->
        <div class="mb-6">
            <div class="bg-white rounded-lg shadow-md">
                <div class="p-6">
                    <h2 class="text-2xl font-bold mb-4 text-gray-800">Panel de Control</h2>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="bg-indigo-50 p-4 rounded-lg text-center">
                            <i class="fas fa-boxes text-3xl text-indigo-600 mb-2"></i>
                            <div class="text-3xl font-bold text-indigo-600" id="total-articles">0</div>
                            <div class="text-sm text-gray-600">Artículos</div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg text-center">
                            <i class="fas fa-chart-line text-3xl text-green-600 mb-2"></i>
                            <div class="text-3xl font-bold text-green-600" id="total-records">0</div>
                            <div class="text-sm text-gray-600">Registros</div>
                        </div>
                        <div class="bg-amber-50 p-4 rounded-lg text-center">
                            <i class="fas fa-calendar-alt text-3xl text-amber-600 mb-2"></i>
                            <div class="text-3xl font-bold text-amber-600" id="forecast-months">6</div>
                            <div class="text-sm text-gray-600">Meses pronosticados</div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg text-center">
                            <i class="fas fa-brain text-3xl text-purple-600 mb-2"></i>
                            <div class="text-3xl font-bold text-purple-600" id="total-models">4</div>
                            <div class="text-sm text-gray-600">Modelos</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Data Upload Section -->
        <div class="mb-6" id="data-section">
            <div class="bg-white rounded-lg shadow-md">
                <div class="bg-indigo-600 px-6 py-4 rounded-t-lg">
                    <h5 class="text-white font-medium mb-0">Gestión de Datos</h5>
                </div>
                <div class="p-6">
                    <form id="upload-form" enctype="multipart/form-data">
                        <div 
                            class="border-2 border-dashed border-indigo-300 rounded-lg p-8 text-center hover:bg-indigo-50 transition-colors duration-200 cursor-pointer mb-4"
                            onclick="document.getElementById('file-input').click()"
                        >
                            <i class="fas fa-file-excel text-4xl text-indigo-500 mb-3"></i>
                            <h5 class="text-lg font-medium text-gray-700 mb-1">Cargar Archivo CSV o Excel</h5>
                            <p class="text-gray-500">Haz clic aquí o arrastra tu archivo</p>
                            <input type="file" id="file-input" name="file" class="hidden" accept=".csv,.xlsx,.xls">
                        </div>
                        <div id="file-info" class="mt-2 mb-4 hidden">
                            <div class="bg-blue-50 border border-blue-200 text-blue-700 px-4 py-3 rounded flex items-center">
                                <i class="fas fa-info-circle mr-2"></i>
                                <span id="file-name" class="flex-grow"></span>
                                <button type="button" id="clear-file" class="text-blue-500 hover:text-blue-700">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <button type="submit" id="upload-button" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md flex items-center">
                            <div id="upload-spinner" class="animate-spin mr-2 hidden">
                                <i class="fas fa-circle-notch"></i>
                            </div>
                            <i class="fas fa-upload mr-2"></i>
                            <span class="button-text">Cargar Datos</span>
                        </button>
                        <p class="text-sm text-gray-500 mt-2">
                            <i class="fas fa-info-circle mr-1"></i>
                            El archivo se cargará automáticamente después de seleccionarlo
                        </p>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Forecast Generation Section -->
        <div class="mb-6" id="forecast-section">
            <div class="bg-white rounded-lg shadow-md">
                <div class="bg-indigo-600 px-6 py-4 rounded-t-lg">
                    <h5 class="text-white font-medium mb-0">Generar Pronósticos</h5>
                </div>
                <div class="p-6">
                    <form id="forecast-form">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div>
                                <label for="article-select" class="block text-sm font-medium text-gray-700 mb-1">
                                    Seleccionar Artículo
                                </label>
                                <select 
                                    class="w-full rounded-md border border-gray-300 py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
                                    id="article-select" 
                                    required
                                >
                                    <option value="">Seleccione un artículo...</option>
                                </select>
                            </div>
                            <div>
                                <label for="target-select" class="block text-sm font-medium text-gray-700 mb-1">
                                    Variable a Pronosticar
                                </label>
                                <select 
                                    class="w-full rounded-md border border-gray-300 py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
                                    id="target-select" 
                                    required
                                >
                                    <option value="CANTIDADES">Cantidad</option>                                        
                                </select>
                            </div>
                            <div>
                                <label for="months-input" class="block text-sm font-medium text-gray-700 mb-1">
                                    Meses a Pronosticar
                                </label>
                                <input 
                                    type="number" 
                                    class="w-full rounded-md border border-gray-300 py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
                                    id="months-input" 
                                    min="1" 
                                    max="12" 
                                    value="6" 
                                    required
                                >
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                            <div>
                                <div class="flex items-center">
                                    <input
                                        type="checkbox"
                                        id="sarima-check"
                                        class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
                                        checked
                                    >
                                    <label for="sarima-check" class="ml-2 block text-sm text-gray-700">
                                        <span class="model-badge model-sarima">SARIMA</span> Modelo Estadístico
                                    </label>
                                </div>
                            </div>
                            <div>
                                <div class="flex items-center">
                                    <input
                                        type="checkbox"
                                        id="lstm-check"
                                        class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
                                        checked
                                    >
                                    <label for="lstm-check" class="ml-2 block text-sm text-gray-700">
                                        <span class="model-badge model-lstm">LSTM</span> Red Neuronal LSTM
                                    </label>
                                </div>
                            </div>
                            <div>
                                <div class="flex items-center">
                                    <input
                                        type="checkbox"
                                        id="gru-check"
                                        class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
                                        checked
                                    >
                                    <label for="gru-check" class="ml-2 block text-sm text-gray-700">
                                        <span class="model-badge model-gru">GRU</span> Red Neuronal GRU
                                    </label>
                                </div>
                            </div>
                            <div>
                                <div class="flex items-center">
                                    <input
                                        type="checkbox"
                                        id="xgboost-check"
                                        class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
                                        checked
                                    >
                                    <label for="xgboost-check" class="ml-2 block text-sm text-gray-700">
                                        <span class="model-badge model-xgboost">XGBOOST</span> XGBoost Regressor
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Sección de Optimización de Modelo -->
                        <div class="mb-6 pt-2 border-t border-gray-200">
                            <h6 class="text-sm font-medium text-gray-800 mb-3">Optimización de Hiperparámetros</h6>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="optimizer-model-select" class="block text-sm font-medium text-gray-700 mb-1">
                                        Modelo a Optimizar
                                    </label>
                                    <select 
                                        id="optimizer-model-select" 
                                        class="w-full rounded-md border border-gray-300 py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
                                    >
                                        <option value="XGBOOST">XGBoost (Regressor)</option>
                                        <option value="SARIMA">SARIMA (Estadístico)</option>
                                        <option value="LSTM">LSTM (Red Neuronal)</option>
                                        <option value="GRU">GRU (Red Neuronal)</option>
                                    </select>
                                </div>
                                <div class="flex items-end">
                                    <button type="button" id="optimize-button" class="btn-secondary w-full">
                                        <i class="fas fa-cogs mr-1"></i> Optimizar Modelo
                                    </button>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">
                                <i class="fas fa-info-circle mr-1"></i>
                                La optimización puede tardar varios minutos dependiendo del modelo y cantidad de datos
                            </p>
                        </div>
                        
                        <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md flex items-center">
                            <i class="fas fa-calculator mr-1"></i> Generar Pronósticos
                        </button>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Results Section -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6" id="results-section">
            <div class="md:col-span-2">
                <div class="bg-white rounded-lg shadow-md h-full">
                    <div class="bg-indigo-600 px-6 py-4 rounded-t-lg flex justify-between items-center">
                        <h5 class="text-white font-medium mb-0">Gráfico de Pronóstico</h5>
                        <button id="download-chart" class="text-white hover:bg-indigo-700 rounded-md px-2 py-1 flex items-center text-sm">
                            <i class="fas fa-download mr-1"></i> Descargar
                        </button>
                    </div>
                    <div class="p-6">
                        <div class="relative h-[350px]" id="forecasting-chart">
                            <div id="chart-loader" class="hidden absolute inset-0 items-center justify-center">
                                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div>
                            </div>
                            <canvas id="forecast-chart" class="w-full h-full"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <div>
                <div class="bg-white rounded-lg shadow-md h-full">
                    <div class="bg-indigo-600 px-6 py-4 rounded-t-lg">
                        <h5 class="text-white font-medium mb-0">Métricas de Evaluación</h5>
                    </div>
                    <div class="p-6">
                        <div id="metrics-container">
                            <div class="border-l-4 border-indigo-500 pl-4 py-2 mb-3 bg-indigo-50 rounded-r">
                                <div class="text-xs text-gray-500">Error Cuadrático Medio (MSE)</div>
                                <div class="text-lg font-semibold" id="metric-mse">-</div>
                            </div>
                            <div class="border-l-4 border-indigo-500 pl-4 py-2 mb-3 bg-indigo-50 rounded-r">
                                <div class="text-xs text-gray-500">Raíz del Error Cuadrático Medio (RMSE)</div>
                                <div class="text-lg font-semibold" id="metric-rmse">-</div>
                            </div>
                            <div class="border-l-4 border-indigo-500 pl-4 py-2 mb-3 bg-indigo-50 rounded-r">
                                <div class="text-xs text-gray-500">Error Absoluto Medio (MAE)</div>
                                <div class="text-lg font-semibold" id="metric-mae">-</div>
                            </div>
                            <div class="border-l-4 border-indigo-500 pl-4 py-2 mb-3 bg-indigo-50 rounded-r">
                                <div class="text-xs text-gray-500">Error Porcentual Absoluto Medio (MAPE)</div>
                                <div class="text-lg font-semibold" id="metric-mape">-</div>
                            </div>
                            <div class="border-l-4 border-indigo-500 pl-4 py-2 mb-3 bg-indigo-50 rounded-r">
                                <div class="text-xs text-gray-500">Coeficiente de Determinación (R²)</div>
                                <div class="text-lg font-semibold" id="metric-r2">-</div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h6 class="text-sm font-medium text-gray-700 mb-2">Mejor Modelo</h6>
                            <div class="flex items-center mb-3">
                                <span class="model-badge model-lstm" id="best-model-badge">LSTM</span>
                                <span class="ml-2 text-gray-700" id="best-model-name">Red Neuronal LSTM</span>
                            </div>
                            <button id="download-forecast" class="w-full text-indigo-700 bg-indigo-100 hover:bg-indigo-200 px-3 py-1 rounded flex items-center justify-center text-sm">
                                <i class="fas fa-file-csv mr-1"></i> Exportar Pronóstico
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Forecast Table Section -->
        <div class="mb-6">
            <div class="bg-white rounded-lg shadow-md">
                <div class="bg-indigo-600 px-6 py-4 rounded-t-lg">
                    <h5 class="text-white font-medium mb-0">Tabla de Pronósticos</h5>
                </div>
                <div class="p-6 overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr>
                                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Artículo</th>
                                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Modelo</th>
                                <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Valor</th>
                            </tr>
                        </thead>
                        <tbody id="forecast-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- La tabla se llenará dinámicamente con JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Safety Stock Section -->
        <div class="mb-6" id="safety-stock-section">
            <div class="bg-white rounded-lg shadow-md">
                <div class="bg-indigo-600 px-6 py-4 rounded-t-lg">
                    <h5 class="text-white font-medium mb-0">Stock de Seguridad</h5>
                </div>
                <div class="p-6">
                    <!-- Formulario de carga de tiempos de entrega -->
                    <div class="mb-4 border-b border-gray-200 pb-4">
                        <h6 class="text-md font-medium mb-3">Carga de Tiempos de Entrega</h6>
                        <form id="leadtime-form" enctype="multipart/form-data">
                            <div class="flex flex-col md:flex-row md:items-end gap-3">
                                <div class="flex-grow">
                                    <label for="leadtime-file" class="block text-sm font-medium text-gray-700 mb-1">
                                        Archivo Excel con Tiempos de Entrega
                                    </label>
                                    <div class="flex">
                                        <input 
                                            type="file" 
                                            id="leadtime-file" 
                                            class="w-full rounded-l-md border border-gray-300 py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
                                            accept=".xls,.xlsx"
                                        >
                                        <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-r-md flex items-center">
                                            <i class="fas fa-upload mr-1"></i> Cargar
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">
                                <i class="fas fa-info-circle mr-1"></i>
                                Cargue un archivo Excel con los tiempos de entrega para cada artículo
                            </p>
                        </form>
                    </div>
                    
                    <!-- Formulario de cálculo de stock de seguridad -->
                    <div class="mb-4">
                        <form id="safety-stock-form">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div>
                                    <label for="ss-article-select" class="block text-sm font-medium text-gray-700 mb-1">
                                        Seleccionar Artículo
                                    </label>
                                    <select 
                                        class="w-full rounded-md border border-gray-300 py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
                                        id="ss-article-select" 
                                        required
                                    >
                                        <option value="">Seleccione un artículo...</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="ss-target-select" class="block text-sm font-medium text-gray-700 mb-1">
                                        Variable a Considerar
                                    </label>
                                    <select 
                                        class="w-full rounded-md border border-gray-300 py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
                                        id="ss-target-select" 
                                        required
                                    >
                                        <option value="CANTIDADES">Cantidad</option>
                                        <option value="PRODUCCIÓN">Producción</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="ss-method-select" class="block text-sm font-medium text-gray-700 mb-1">
                                        Método de Cálculo
                                    </label>
                                    <select 
                                        class="w-full rounded-md border border-gray-300 py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
                                        id="ss-method-select" 
                                    >
                                        <option value="basic">Básico</option>
                                        <option value="leadtime_var">Con Variabilidad</option>
                                        <option value="review">Con Período de Revisión</option>
                                        <option value="insufficient">Para Datos Insuficientes</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- PRIMERA SUGERENCIA: Nivel de Servicio y Período de Revisión -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="ss-service-level" class="block text-sm font-medium text-gray-700 mb-1">
                                        Nivel de Servicio (%)
                                    </label>
                                    <input
                                        type="number"
                                        class="w-full rounded-md border border-gray-300 py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
                                        id="ss-service-level"
                                        min="50"
                                        max="99.9"
                                        value="95"
                                        step="0.1"
                                    >
                                </div>
                                <div id="review-period-container" class="hidden">
                                    <label for="ss-review-period" class="block text-sm font-medium text-gray-700 mb-1">
                                        Período de Revisión (días)
                                    </label>
                                    <input
                                        type="number"
                                        class="w-full rounded-md border border-gray-300 py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
                                        id="ss-review-period"
                                        min="1"
                                        max="90"
                                        value="30"
                                    >
                                </div>
                            </div>
                            
                            <!-- SEGUNDA SUGERENCIA: Horizonte de Pronóstico y Usar Pronósticos -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="ss-forecast-horizon" class="block text-sm font-medium text-gray-700 mb-1">
                                        Horizonte de Pronóstico (meses)
                                    </label>
                                    <input
                                        type="number"
                                        class="w-full rounded-md border border-gray-300 py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
                                        id="ss-forecast-horizon"
                                        min="1"
                                        max="12"
                                        value="6"
                                    >
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">
                                        Usar Pronósticos
                                    </label>
                                    <div class="flex items-center h-10">
                                        <label class="inline-flex items-center">
                                            <input
                                                type="checkbox"
                                                id="ss-use-forecasts"
                                                class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
                                                checked
                                            >
                                            <span class="ml-2 text-sm text-gray-700">Calcular stock de seguridad usando pronósticos</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex space-x-4">
                                <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md flex items-center">
                                    <i class="fas fa-calculator mr-1"></i> Calcular Stock de Seguridad
                                </button>
                                <button type="button" id="calculate-all-ss" class="text-indigo-700 bg-indigo-100 hover:bg-indigo-200 px-4 py-2 rounded-md flex items-center">
                                    <i class="fas fa-list-check mr-1"></i> Calcular para Todos
                                </button>
                                <button type="button" id="export-ss" class="text-indigo-700 bg-indigo-100 hover:bg-indigo-200 px-4 py-2 rounded-md flex items-center">
                                    <i class="fas fa-file-export mr-1"></i> Exportar Resultados
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Resultados del cálculo -->
                    <div id="ss-results-container" class="hidden mt-6">
                        <h6 class="text-md font-medium mb-3">Resultados del Cálculo</h6>
                        
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                            <div class="bg-indigo-50 p-4 rounded-lg">
                                <h6 class="text-sm font-semibold text-indigo-700 mb-1">Stock de Seguridad</h6>
                                <p class="text-2xl font-bold text-indigo-800" id="ss-result-value">-</p>
                                <p class="text-xs text-gray-500" id="ss-unit">unidades</p>
                            </div>
                            
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h6 class="text-sm font-semibold text-blue-700 mb-1">Tiempo de Entrega</h6>
                                <p class="text-2xl font-bold text-blue-800" id="ss-leadtime-value">-</p>
                                <p class="text-xs text-gray-500">días</p>
                            </div>
                            
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <h6 class="text-sm font-semibold text-purple-700 mb-1">Nivel de Servicio</h6>
                                <p class="text-2xl font-bold text-purple-800" id="ss-service-level-value">-</p>
                                <p class="text-xs text-gray-500">porcentaje</p>
                            </div>
                            
                            <!-- Nuevo panel para el punto de reorden -->
                            <div class="bg-amber-50 p-4 rounded-lg">
                                <h6 class="text-sm font-semibold text-amber-700 mb-1">Punto de Reorden</h6>
                                <p class="text-2xl font-bold text-amber-800" id="ss-reorder-point-value">-</p>
                                <p class="text-xs text-gray-500">unidades</p>
                                <p class="text-xs text-gray-500 mt-1">Cuando el stock llegue a este nivel, realiza un pedido</p>
                            </div>
                        </div>
                        
                        <!-- Stock de Seguridad por Mes -->
                        <div id="ss-monthly-container" class="mb-4 hidden">
                            <h6 class="text-sm font-medium mb-2">Stock de Seguridad por Mes</h6>
                            <div class="bg-amber-50 p-4 rounded-lg">
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200">
                                        <thead>
                                            <tr>
                                                <th class="px-3 py-2 bg-amber-100 text-left text-xs font-medium text-amber-700 uppercase tracking-wider">Fecha</th>
                                                <th class="px-3 py-2 bg-amber-100 text-left text-xs font-medium text-amber-700 uppercase tracking-wider">Stock de Seguridad</th>
                                                <th class="px-3 py-2 bg-amber-100 text-left text-xs font-medium text-amber-700 uppercase tracking-wider">Pronóstico</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ss-monthly-table" class="bg-white divide-y divide-gray-100">
                                            <!-- Se completará con JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h6 class="text-sm font-medium mb-2">Estadísticas de la Demanda</h6>
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <div class="grid grid-cols-2 gap-2">
                                        <div>
                                            <p class="text-xs text-gray-500">Demanda Promedio</p>
                                            <p class="text-md font-medium" id="ss-avg-demand">-</p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-500">Desviación Estándar</p>
                                            <p class="text-md font-medium" id="ss-std-dev">-</p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-500">Puntos de Datos</p>
                                            <p class="text-md font-medium" id="ss-data-points">-</p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-500">Tipo de Demanda</p>
                                            <p class="text-md font-medium" id="ss-demand-type">-</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h6 class="text-sm font-medium mb-2">Parámetros de Cálculo</h6>
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <div class="grid grid-cols-2 gap-2">
                                        <div>
                                            <p class="text-xs text-gray-500">Método Utilizado</p>
                                            <p class="text-md font-medium" id="ss-method-used">-</p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-500">Factor Z</p>
                                            <p class="text-md font-medium" id="ss-z-factor">-</p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-500">Lead Time (períodos)</p>
                                            <p class="text-md font-medium" id="ss-leadtime-periods">-</p>
                                        </div>
                                        <div>
                                            <p class="text-xs text-gray-500">Artículo</p>
                                            <p class="text-md font-medium" id="ss-article-name">-</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Información del Modelo -->
                        <div id="ss-model-info-container" class="mt-4 hidden">
                            <h6 class="text-sm font-medium mb-2">Modelo de Pronóstico Utilizado</h6>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-2">
                                    <div>
                                        <p class="text-xs text-gray-500">Modelo</p>
                                        <p class="text-md font-medium" id="ss-model-name">-</p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500">RMSE</p>
                                        <p class="text-md font-medium" id="ss-model-rmse">-</p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-gray-500">MAE</p>
                                        <p class="text-md font-medium" id="ss-model-mae">-</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tabla de resultados para todos los artículos -->
                    <div id="ss-all-results-container" class="hidden mt-6">
                        <h6 class="text-md font-medium mb-3">Resultados para Todos los Artículos</h6>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead>
                                    <tr>
                                        <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Artículo</th>
                                        <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock de Seguridad</th>
                                        <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Punto de Reorden</th>
                                        <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lead Time</th>
                                        <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Demanda Promedio</th>
                                        <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Método</th>
                                    </tr>
                                </thead>
                                <tbody id="ss-all-results-body" class="bg-white divide-y divide-gray-200">
                                    <!-- Se completará con JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Help Section -->
        <div class="mb-6" id="help-section">
            <div class="bg-white rounded-lg shadow-md">
                <div class="bg-indigo-600 px-6 py-4 rounded-t-lg">
                    <h5 class="text-white font-medium mb-0">Ayuda y Documentación</h5>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        <div class="border border-gray-200 rounded-md">
                            <button class="flex justify-between items-center w-full px-4 py-3 text-left text-gray-800 font-medium bg-gray-50 hover:bg-gray-100 rounded-t-md focus:outline-none" id="help-button-1">
                                <span>¿Cómo cargar datos?</span>
                                <i class="fas fa-chevron-down"></i>
                            </button>
                            <div class="px-4 py-3 text-gray-600" id="help-content-1">
                                <p class="mb-2">Para cargar datos en el sistema, siga estos pasos:</p>
                                <ol class="list-decimal pl-5 space-y-1">
                                    <li>Prepare un archivo CSV con separador de punto y coma (;).</li>
                                    <li>El archivo debe contener las columnas: Fecha, CENTRO DE COSTO, ARTÍCULO, CANTIDADES, PRODUCCIÓN.</li>
                                    <li>La fecha debe estar en formato "mes-año" (ej. "feb-22").</li>
                                    <li>Haga clic en la sección "Gestión de Datos" y seleccione su archivo CSV.</li>
                                    <li>El archivo se cargará automáticamente una vez seleccionado.</li>
                                </ol>
                            </div>
                        </div>
                        
                        <div class="border border-gray-200 rounded-md">
                            <button class="flex justify-between items-center w-full px-4 py-3 text-left text-gray-800 font-medium bg-gray-50 hover:bg-gray-100 rounded-t-md focus:outline-none" id="help-button-2">
                                <span>¿Cómo generar pronósticos?</span>
                                <i class="fas fa-chevron-down"></i>
                            </button>
                            <div class="hidden px-4 py-3 text-gray-600" id="help-content-2">
                                <p class="mb-2">Para generar pronósticos, siga estos pasos:</p>
                                <ol class="list-decimal pl-5 space-y-1">
                                    <li>Asegúrese de haber cargado datos previamente.</li>
                                    <li>En la sección "Generar Pronósticos", seleccione un artículo.</li>
                                    <li>Elija la variable a pronosticar (Cantidad o Producción).</li>
                                    <li>Defina el número de meses a pronosticar (1-12).</li>
                                    <li>Seleccione los modelos que desea utilizar.</li>
                                    <li>Haga clic en "Generar Pronósticos" para iniciar el proceso.</li>
                                </ol>
                            </div>
                        </div>
                        
                        <div class="border border-gray-200 rounded-md">
                            <button class="flex justify-between items-center w-full px-4 py-3 text-left text-gray-800 font-medium bg-gray-50 hover:bg-gray-100 rounded-t-md focus:outline-none" id="help-button-3">
                                <span>¿Cómo interpretar las métricas?</span>
                                <i class="fas fa-chevron-down"></i>
                            </button>
                            <div class="hidden px-4 py-3 text-gray-600" id="help-content-3">
                                <p class="mb-2">Las métricas de evaluación le ayudan a determinar la precisión de los modelos:</p>
                                <ul class="list-disc pl-5 space-y-1">
                                    <li><strong>MSE (Error Cuadrático Medio):</strong> Promedio de los errores al cuadrado. Menor es mejor.</li>
                                    <li><strong>RMSE (Raíz del Error Cuadrático Medio):</strong> Raíz cuadrada del MSE, en la misma escala que los datos originales. Menor es mejor.</li>
                                    <li><strong>MAE (Error Absoluto Medio):</strong> Promedio de las diferencias absolutas. Menor es mejor.</li>
                                    <li><strong>MAPE (Error Porcentual Absoluto Medio):</strong> Error promedio en términos porcentuales. Menor es mejor.</li>
                                    <li><strong>R² (Coeficiente de determinación):</strong> Proporción de la varianza explicada por el modelo (0-1). Mayor es mejor.</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="border border-gray-200 rounded-md">
                            <button class="flex justify-between items-center w-full px-4 py-3 text-left text-gray-800 font-medium bg-gray-50 hover:bg-gray-100 rounded-t-md focus:outline-none" id="help-button-4">
                                <span>¿Cómo funciona la optimización de modelos?</span>
                                <i class="fas fa-chevron-down"></i>
                            </button>
                            <div class="hidden px-4 py-3 text-gray-600" id="help-content-4">
                                <p class="mb-2">La optimización de modelos mejora la precisión de los pronósticos:</p>
                                <ul class="list-disc pl-5 space-y-1">
                                    <li><strong>¿Qué hace?</strong> Busca automáticamente los mejores parámetros para el modelo específicamente para cada artículo.</li>
                                    <li><strong>¿Cuándo usarla?</strong> Cuando quiera maximizar la precisión del pronóstico para un artículo importante.</li>
                                    <li><strong>¿Cuánto tarda?</strong> El proceso puede tardar entre 5-15 minutos, dependiendo del tamaño de los datos y el modelo seleccionado.</li>
                                    <li><strong>¿Qué mejora?</strong> Puede reducir el error de predicción entre un 15-30% comparado con el modelo sin optimizar.</li>
                                    <li><strong>¿Se guarda?</strong> Sí, los parámetros optimizados se guardan y se reutilizan automáticamente en futuros pronósticos.</li>
                                </ul>
                                <p class="mt-2"><strong>Modelos disponibles para optimización:</strong></p>
                                <ul class="list-disc pl-5 space-y-1">
                                    <li><strong>XGBoost:</strong> Optimiza parámetros como profundidad, árboles y tasa de aprendizaje.</li>
                                    <li><strong>SARIMA:</strong> Optimiza órdenes AR, I, MA y componentes estacionales.</li>
                                    <li><strong>LSTM/GRU:</strong> Optimiza unidades, dropout y ventana temporal.</li>
                                </ul>
                                <p class="mt-2"><strong>Nota:</strong> La optimización se realiza una vez por artículo, y los resultados se utilizan en todas las predicciones futuras para ese artículo hasta que decida optimizar nuevamente.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Optimización -->
    <div class="fixed inset-0 bg-gray-600 bg-opacity-50 items-center justify-center hidden" id="optimization-modal">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full p-6">
            <div class="flex justify-between items-center mb-4">
                <h5 class="text-lg font-medium text-gray-900">
                    Optimizando <span id="optimization-model-name">Modelo</span>
                </h5>
                <button class="text-gray-400 hover:text-gray-500" id="modal-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="text-center">
                <div class="flex justify-center mb-3">
                    <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"></div>
                </div>
                <p class="text-gray-600 mb-4">Optimizando hiperparámetros para mejorar la precisión del pronóstico. Este proceso puede tardar varios minutos.</p>
                <div class="w-full bg-gray-200 rounded-full h-2.5 mb-2">
                    <div id="optimization-progress" class="bg-indigo-600 h-2.5 rounded-full" style="width: 0%"></div>
                </div>
                <p class="text-sm text-gray-500">Pruebas completadas: <span id="trials-completed">0</span> de <span id="total-trials">50</span></p>
            </div>
            <div class="mt-6 flex justify-end">
                <button class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-md" id="modal-close-btn">
                    Cerrar
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-indigo-800 text-white py-4 text-center mt-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <p class="text-sm">© 2025 Sistema de Pronóstico de Inventario</p>
        </div>
    </footer>

    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    
    <!-- Script adicional para controlar colapsables -->
    <script>
        // Mobile menu toggle
        document.getElementById('mobile-menu-button').addEventListener('click', function() {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        });
        
        // Help section accordions
        document.querySelectorAll('[id^="help-button-"]').forEach(button => {
            button.addEventListener('click', function() {
                const contentId = this.id.replace('button', 'content');
                const content = document.getElementById(contentId);
                content.classList.toggle('hidden');
                
                // Toggle icon
                const icon = this.querySelector('i');
                if (content.classList.contains('hidden')) {
                    icon.classList.remove('fa-chevron-up');
                    icon.classList.add('fa-chevron-down');
                } else {
                    icon.classList.remove('fa-chevron-down');
                    icon.classList.add('fa-chevron-up');
                }
            });
        });
        
        // Show first help section by default
        document.getElementById('help-content-1').classList.remove('hidden');
        document.querySelector('#help-button-1 i').classList.remove('fa-chevron-down');
        document.querySelector('#help-button-1 i').classList.add('fa-chevron-up');
        
        // Modal controls
        document.getElementById('optimize-button').addEventListener('click', function() {
            // Actualizar el nombre del modelo en el modal
            const modelSelect = document.getElementById('optimizer-model-select');
            document.getElementById('optimization-model-name').textContent = modelSelect.options[modelSelect.selectedIndex].text;
            // Mostrar modal
            document.getElementById('optimization-modal').classList.remove('hidden');
        });
        
        document.querySelectorAll('#modal-close, #modal-close-btn').forEach(element => {
            element.addEventListener('click', function() {
                document.getElementById('optimization-modal').classList.add('hidden');
            });
        });
    </script>
</body>
</html>
